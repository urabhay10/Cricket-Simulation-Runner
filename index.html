<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextGen Cricket Simulator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        .suggestion-active {
            background-color: #334155;
            border-left: 4px solid #10b981;
        }

        .ball-pop {
            animation: pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Custom Table Styles */
        .score-table th { @apply text-xs uppercase tracking-wider text-slate-500 font-semibold py-2 px-3 text-right; }
        .score-table th:first-child { @apply text-left; }
        .score-table td { @apply py-2 px-3 text-sm border-b border-slate-800 text-right; }
        .score-table td:first-child { @apply text-left font-medium text-slate-200; }
        .score-table tr:last-child td { @apply border-b-0; }
        .score-table tr:hover { @apply bg-slate-800/50; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const PlayerInput = ({ value, onChange, placeholder }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [show, setShow] = useState(false);
            const [selectedIndex, setSelectedIndex] = useState(-1);
            const listRef = useRef(null);

            const handleInputChange = (e) => {
                const text = e.target.value;
                onChange(text);
                if (text.length >= 1) {
                    fetch(`https://hewhocodes247-cricket-transformer-api.hf.space/players/search?q=${text}`)
                        .then(res => res.json())
                        .then(data => {
                            setSuggestions(data);
                            setShow(true);
                            setSelectedIndex(-1);
                        })
                        .catch(err => console.error(err));
                } else {
                    setSuggestions([]);
                    setShow(false);
                }
            };

            const handleSelect = (player) => {
                if (!player) return;
                onChange(player.name);
                setShow(false);
                setSuggestions([]);
                setSelectedIndex(-1);
            };

            const handleKeyDown = (e) => {
                if (!show || suggestions.length === 0) return;
                if (e.key === "ArrowDown") {
                    e.preventDefault();
                    setSelectedIndex(prev => (prev < suggestions.length - 1 ? prev + 1 : prev));
                } else if (e.key === "ArrowUp") {
                    e.preventDefault();
                    setSelectedIndex(prev => (prev > 0 ? prev - 1 : prev));
                } else if (e.key === "Enter") {
                    e.preventDefault();
                    if (selectedIndex >= 0 && suggestions[selectedIndex]) {
                        handleSelect(suggestions[selectedIndex]);
                    }
                } else if (e.key === "Escape") {
                    setShow(false);
                }
            };

            return (
                <div className="relative">
                    <input
                        type="text"
                        className="w-full bg-slate-800 border border-slate-700 rounded p-2 text-sm focus:border-emerald-500 focus:outline-none transition-colors text-white"
                        placeholder={placeholder}
                        value={value}
                        onChange={handleInputChange}
                        onKeyDown={handleKeyDown}
                        onBlur={() => setTimeout(() => setShow(false), 200)}
                    />
                    {show && suggestions.length > 0 && (
                        <ul ref={listRef} className="absolute z-10 w-full bg-slate-800 border border-slate-700 mt-1 rounded max-h-48 overflow-y-auto shadow-xl scrollbar-hide">
                            {suggestions.map((s, i) => (
                                <li key={i} 
                                    className={`p-2 hover:bg-slate-700 cursor-pointer text-sm border-b border-slate-700/50 flex justify-between transition-colors ${i === selectedIndex ? 'suggestion-active bg-slate-700' : ''}`}
                                    onMouseEnter={() => setSelectedIndex(i)}
                                    onClick={() => handleSelect(s)}>
                                    <span className="text-white">{s.name}</span>
                                    <span className={`text-xs px-2 py-0.5 rounded h-fit ${s.role === 'Bowler' ? 'bg-rose-900/50 text-rose-300' : 'bg-emerald-900/50 text-emerald-300'}`}>
                                        {s.role}
                                    </span>
                                </li>
                            ))}
                        </ul>
                    )}
                </div>
            );
        };

        const ScoreCardLive = ({ detail, live }) => {
            if (!detail) return null;
            const { striker, non_striker, bowler, total_runs = 0, wickets = 0, bat_team = "", target, over = 0, ball = 0 } = detail || {};
            
            const ballsDone = over * 6 + ball;
            const crr = ballsDone > 0 ? ((total_runs / ballsDone) * 6).toFixed(2) : "0.00";
            let rrr = null;
            if (target) {
                const ballsRem = 120 - ballsDone;
                const runsRem = target - total_runs;
                rrr = ballsRem > 0 ? ((runsRem / ballsRem) * 6).toFixed(2) : "-";
            }

            return (
                <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 shadow-2xl border border-slate-700 mb-6 relative overflow-hidden">
                    {live && <div className="absolute top-4 right-4 flex items-center gap-2">
                        <span className="animate-pulse w-3 h-3 bg-red-500 rounded-full shadow-[0_0_10px_rgba(239,68,68,0.6)]"></span>
                        <span className="text-xs font-bold text-red-500 uppercase tracking-widest">Live</span>
                    </div>}
                    <div className="flex flex-col items-center justify-center mb-8 relative z-10">
                        <div className="text-sm text-emerald-400 uppercase tracking-[0.2em] font-bold mb-1">{bat_team} Batting</div>
                        <div className="text-7xl font-black font-mono tracking-tighter text-white drop-shadow-lg">{total_runs}<span className="text-slate-600 mx-1">/</span>{wickets}</div>
                        <div className="text-slate-400 font-mono mt-2 text-lg">Overs: <span className="text-white">{over}.{ball}</span></div>
                        
                        <div className="flex gap-8 mt-6 w-full justify-center">
                            <div className="text-center">
                                <div className="text-[10px] uppercase text-slate-500 font-bold tracking-widest">CRR</div>
                                <div className="text-xl font-mono text-emerald-400">{crr}</div>
                            </div>
                            {target && (
                                <>
                                <div className="text-center">
                                    <div className="text-[10px] uppercase text-slate-500 font-bold tracking-widest">Target</div>
                                    <div className="text-xl font-mono text-white">{target}</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-[10px] uppercase text-slate-500 font-bold tracking-widest">RRR</div>
                                    <div className="text-xl font-mono text-rose-400">{rrr}</div>
                                </div>
                                </>
                            )}
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10">
                        {/* Batting Card */}
                        <div className="bg-slate-950/40 p-4 rounded-xl border border-white/5 backdrop-blur-sm">
                            <div className="text-[10px] text-slate-500 uppercase mb-3 flex items-center gap-2 font-bold tracking-wider">
                                <i data-lucide="users" className="w-3 h-3"></i> Batting
                            </div>
                            {striker && (
                                <div className="flex justify-between items-center mb-2 pb-2 border-b border-white/5">
                                    <div className="flex items-center gap-2">
                                        <div className="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></div>
                                        <span className="font-bold text-white text-lg">{striker.name}</span>
                                    </div>
                                    <div className="font-mono text-emerald-400 text-xl font-bold">{striker.runs}<span className="text-slate-500 text-xs ml-1 font-normal">({striker.balls})</span></div>
                                </div>
                            )}
                            {non_striker && (
                                <div className="flex justify-between items-center opacity-70">
                                    <span className="text-slate-300 font-medium pl-3.5">{non_striker.name}</span>
                                    <span className="font-mono text-slate-400">{non_striker.runs}<span className="text-slate-600 text-xs ml-1">({non_striker.balls})</span></span>
                                </div>
                            )}
                        </div>

                        {/* Bowling Card */}
                        <div className="bg-slate-950/40 p-4 rounded-xl border border-white/5 backdrop-blur-sm">
                             <div className="text-[10px] text-slate-500 uppercase mb-3 flex items-center gap-2 font-bold tracking-wider">
                                <i data-lucide="crosshair" className="w-3 h-3"></i> Bowling
                            </div>
                            {bowler && (
                                <div>
                                    <div className="flex justify-between items-center mb-1">
                                        <span className="font-bold text-rose-300 text-lg">{bowler.name}</span>
                                    </div>
                                    <div className="flex justify-between items-center mt-2">
                                        <div className="text-center">
                                            <div className="text-[10px] text-slate-500">W</div>
                                            <div className="font-mono font-bold text-white text-lg">{bowler.wickets}</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-[10px] text-slate-500">R</div>
                                            <div className="font-mono text-slate-300 text-lg">{bowler.runs_given}</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-[10px] text-slate-500">O</div>
                                            <div className="font-mono text-slate-300 text-lg">{bowler.overs}.{ball}</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const Commentary = ({ events }) => {
            const endRef = useRef(null);
            useEffect(() => endRef.current?.scrollIntoView({ behavior: "smooth" }), [events]);

            const groupedOvers = [];
            events.forEach(e => {
                if (!e || typeof e.over === 'undefined') return;
                
                const key = `${e.innings}-${e.over}`;
                let over = groupedOvers.find(o => o.key === key);
                if (!over) {
                    over = { key: key, team: e.bat_team, balls: [], runs: e.total_runs, wickets: e.wickets, overNum: e.over + 1 };
                    groupedOvers.push(over);
                }
                over.balls.push(e.is_wicket ? 'W' : e.runs_scored);
                // Update totals to the latest state of the over
                over.runs = e.total_runs;
                over.wickets = e.wickets;
            });

            return (
                <div className="bg-slate-900 rounded-xl border border-slate-800 h-96 flex flex-col">
                    <div className="p-3 border-b border-slate-800 bg-slate-900/50 backdrop-blur font-bold text-slate-400 text-xs uppercase tracking-widest sticky top-0">
                        Live Commentary
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 scrollbar-hide space-y-3">
                        {events.length === 0 && <div className="text-center text-slate-600 italic mt-32">Waiting for first ball...</div>}
                        {groupedOvers.map((over) => (
                            <div key={over.key} className="p-4 bg-slate-800 rounded-lg border border-slate-700/50 flex items-center justify-between ball-pop shadow-sm">
                                <div className="flex flex-col gap-1">
                                    <span className="text-emerald-400 font-bold text-sm">Over {over.overNum}</span>
                                    <span className="text-slate-500 text-xs font-bold">{over.team}</span>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="flex gap-1.5">
                                        {over.balls.map((b, j) => (
                                            <span key={j} className={`w-7 h-7 flex items-center justify-center rounded text-xs font-bold font-mono shadow-sm
                                                ${b === 'W' ? 'bg-rose-500 text-white' : 
                                                  b === 6 ? 'bg-purple-500 text-white' : 
                                                  b === 4 ? 'bg-emerald-500 text-slate-900' : 
                                                  'bg-slate-700 text-slate-300'}`}>
                                                {b}
                                            </span>
                                        ))}
                                    </div>
                                    <div className="w-px h-8 bg-slate-700 mx-1"></div>
                                    <div className="text-right">
                                        <div className="text-white font-mono font-bold text-lg">{over.runs}/{over.wickets}</div>
                                    </div>
                                </div>
                            </div>
                        ))}
                        <div ref={endRef} />
                    </div>
                </div>
            );
        };

        const DetailedScorecard = ({ teamName, data }) => {
            if (!data) return null;

            return (
                <div className="mb-8 last:mb-0">
                    <div className="bg-slate-800/80 px-4 py-3 border-b border-slate-700 flex justify-between items-center rounded-t-xl">
                        <div className="flex items-center gap-3">
                            <span className="w-2 h-6 bg-emerald-500 rounded-sm"></span>
                            <span className="font-black text-xl text-white tracking-tight">{teamName}</span>
                        </div>
                        <span className="font-mono font-bold text-2xl text-emerald-400">{data.score}</span>
                    </div>
                    
                    <div className="bg-slate-900 border border-t-0 border-slate-800 rounded-b-xl overflow-hidden p-4">
                        {/* Batting Table */}
                        <div className="mb-6">
                            <h4 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 px-2">Batting</h4>
                            <div className="overflow-x-auto">
                                <table className="w-full score-table">
                                    <thead className="bg-slate-900 border-b border-slate-700">
                                        <tr>
                                            <th className="w-1/3">Batter</th>
                                            <th>R</th>
                                            <th>B</th>
                                            <th>4s</th>
                                            <th>6s</th>
                                            <th>SR</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {data.batting && data.batting.map((b, i) => {
                                            const sr = b.balls > 0 ? ((b.runs / b.balls) * 100).toFixed(1) : "0.0";
                                            // Fallbacks for 4s/6s if API doesn't send them yet
                                            const fours = b.fours || "-";
                                            const sixes = b.sixes || "-";
                                            return (
                                                <tr key={i} className={!b.out && b.balls > 0 ? "bg-emerald-900/10" : ""}>
                                                    <td>
                                                        <div className="flex flex-col">
                                                            <span className={`${b.out ? 'text-slate-400' : 'text-emerald-400 font-bold'}`}>{b.name} {!b.out ? '*' : ''}</span>
                                                            <span className="text-[10px] text-slate-500 font-normal lowercase">{b.out ? 'out' : 'not out'}</span>
                                                        </div>
                                                    </td>
                                                    <td className="font-bold text-white">{b.runs}</td>
                                                    <td className="text-slate-400">{b.balls}</td>
                                                    <td className="text-slate-500">{fours}</td>
                                                    <td className="text-slate-500">{sixes}</td>
                                                    <td className="text-slate-400 font-mono text-xs">{sr}</td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Bowling Table */}
                        {data.bowling && data.bowling.length > 0 && (
                            <div>
                                <h4 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 px-2">Bowling</h4>
                                <div className="overflow-x-auto">
                                    <table className="w-full score-table">
                                        <thead className="bg-slate-900 border-b border-slate-700">
                                            <tr>
                                                <th className="w-1/3">Bowler</th>
                                                <th>O</th>
                                                <th>M</th>
                                                <th>R</th>
                                                <th>W</th>
                                                <th>Econ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.bowling.map((b, i) => {
                                                const econ = b.overs > 0 ? (b.runs / b.overs).toFixed(2) : "-";
                                                return (
                                                    <tr key={i}>
                                                        <td className="text-rose-300 font-medium">{b.name}</td>
                                                        <td className="text-slate-300">{b.overs}</td>
                                                        <td className="text-slate-500">{b.maidens || 0}</td>
                                                        <td className="text-slate-300">{b.runs}</td>
                                                        <td className="font-bold text-white">{b.wickets}</td>
                                                        <td className="text-slate-400 font-mono text-xs">{econ}</td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [stage, setStage] = useState('setup');
            const [numMatches, setNumMatches] = useState(1);
            const [team1, setTeam1] = useState({ name: "India", players: Array(11).fill("") });
            const [team2, setTeam2] = useState({ name: "Australia", players: Array(11).fill("") });
            const [matchDetail, setMatchDetail] = useState(null);
            const [ballEvents, setBallEvents] = useState([]);
            const [history, setHistory] = useState([]);
            const [seriesComplete, setSeriesComplete] = useState(null);

            const fillDefaults = () => {
                setTeam1({ name: "India", players: ["RG Sharma", "V Kohli", "RR Pant", "SA Yadav", "S Dube", "HH Pandya", "RA Jadeja", "AR Patel", "Kuldeep Yadav", "JJ Bumrah", "Arshdeep Singh"] });
                setTeam2({ name: "Australia", players: ["DA Warner", "TM Head", "MR Marsh", "GJ Maxwell", "MP Stoinis", "TH David", "MS Wade", "PJ Cummins", "MA Starc", "A Zampa", "JR Hazlewood"] });
            };

            const updatePlayer = (tId, idx, v) => {
                if (tId === 1) { const n = [...team1.players]; n[idx] = v; setTeam1({...team1, players: n}); }
                else { const n = [...team2.players]; n[idx] = v; setTeam2({...team2, players: n}); }
            };

            const startSimulation = async () => {
                setStage('live');
                setBallEvents([]);
                setMatchDetail(null);
                setHistory([]);
                setSeriesComplete(null);
                
                try {
                    const response = await fetch('https://hewhocodes247-cricket-transformer-api.hf.space/simulate_series_stream', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            team1_name: team1.name,
                            team1_players: team1.players,
                            team2_name: team2.name,
                            team2_players: team2.players,
                            num_matches: numMatches
                        })
                    });

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let buffer = "";

                    const processLine = (line) => {
                        if (!line.trim()) return;
                        try {
                            const data = JSON.parse(line);
                            if (data.type === 'ball') {
                                setMatchDetail(data.detail);
                                setBallEvents(prev => [...prev, { ...data.detail, innings: data.innings }]);
                            } else if (data.type === 'match_update') {
                                setHistory(prev => [data, ...prev]);
                            } else if (data.type === 'series_complete') {
                                setSeriesComplete(data);
                            }
                        } catch (e) {
                            console.error("Error parsing JSON line:", line, e);
                        }
                    };

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        const chunk = decoder.decode(value, { stream: true });
                        buffer += chunk;
                        const lines = buffer.split('\n');
                        buffer = lines.pop(); 
                        lines.forEach(processLine);
                    }
                    if (buffer.trim()) processLine(buffer);
                } catch (err) {
                    console.error("Simulation Error:", err);
                    alert("Simulation failure. Check console.");
                    setStage('setup');
                }
            };
            
            if (stage === 'setup') return (
                <div className="min-h-screen p-8 max-w-6xl mx-auto">
                    <header className="mb-12 text-center">
                        <h1 className="text-5xl font-black bg-gradient-to-r from-emerald-400 to-cyan-500 bg-clip-text text-transparent tracking-tight">CRICKET SERIES SIMULATOR</h1>
                    </header>
                    <div className="grid md:grid-cols-2 gap-12">
                        <div className="space-y-4">
                            <input value={team1.name} onChange={e => setTeam1({...team1, name: e.target.value})} className="w-full bg-transparent text-2xl font-bold border-b-2 border-slate-700 focus:border-emerald-500 outline-none pb-2 text-emerald-400" placeholder="Team 1" />
                            {team1.players.map((p, i) => <PlayerInput key={i} value={p} onChange={v => updatePlayer(1, i, v)} placeholder={`Player ${i+1}`} />)}
                        </div>
                        <div className="space-y-4 text-right">
                            <input value={team2.name} onChange={e => setTeam2({...team2, name: e.target.value})} className="w-full bg-transparent text-2xl font-bold border-b-2 border-slate-700 focus:border-rose-500 outline-none pb-2 text-rose-400 text-right" placeholder="Team 2" />
                            {team2.players.map((p, i) => <PlayerInput key={i} value={p} onChange={v => updatePlayer(2, i, v)} placeholder={`Player ${i+1}`} />)}
                        </div>
                    </div>
                    <div className="mt-16 flex flex-col items-center gap-6">
                        <div className="flex items-center gap-4 bg-slate-800 p-3 rounded-xl border border-slate-700">
                            <span className="text-slate-400 font-bold">Games:</span>
                            <input type="number" value={numMatches} onChange={e => setNumMatches(Math.max(1, parseInt(e.target.value) || 1))} className="bg-slate-900 w-16 p-1 text-center font-bold text-emerald-400 border border-slate-700 rounded text-white" />
                        </div>
                        <div className="flex gap-4">
                            <button onClick={fillDefaults} className="px-8 py-3 rounded-xl text-slate-400 border border-slate-700 font-bold hover:bg-slate-800 transition">Quick Fill</button>
                            <button onClick={startSimulation} className="px-12 py-3 rounded-xl bg-emerald-500 text-slate-900 font-black hover:scale-105 transition shadow-[0_0_20px_rgba(16,185,129,0.4)]">START SERIES</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen p-6 bg-slate-950 flex flex-col items-center">
                    {/* Header Bar */}
                    <div className="w-full max-w-6xl flex justify-between items-center mb-6">
                        <button onClick={() => setStage('setup')} className="text-xs font-bold text-slate-500 hover:text-white flex items-center gap-2 px-4 py-2 rounded-full bg-slate-900 border border-slate-800 transition hover:border-slate-600">
                            <i data-lucide="arrow-left" className="w-4 h-4"></i> BACK TO SETUP
                        </button>
                        {seriesComplete && <div className="text-emerald-400 font-black animate-pulse uppercase tracking-widest text-xs border border-emerald-500/20 px-3 py-1 rounded bg-emerald-500/5">Series Concluded</div>}
                    </div>

                    <div className="w-full max-w-6xl grid lg:grid-cols-3 gap-8">
                        
                        {/* LEFT COLUMN: LIVE ACTION (2/3 width on large screens) */}
                        <div className="lg:col-span-2 space-y-6">
                            {/* Loading State */}
                            {!matchDetail && !seriesComplete && (
                                <div className="flex flex-col items-center justify-center h-96 text-slate-500 animate-pulse bg-slate-900/50 rounded-2xl border border-slate-800 border-dashed">
                                    <div className="text-6xl mb-6">üèè</div>
                                    <div className="font-mono text-sm uppercase tracking-widest text-emerald-500">Initializing Pitch...</div>
                                    <div className="text-xs text-slate-600 mt-2">Tossing coin... Checking field...</div>
                                </div>
                            )}

                            <ScoreCardLive detail={matchDetail} live={!seriesComplete} />
                        </div>

                        {/* RIGHT COLUMN: COMMENTARY (1/3 width) */}
                        <div className="lg:col-span-1">
                             <Commentary events={ballEvents} />
                        </div>
                    </div>

                    {/* FULL WIDTH BOTTOM SECTION: MATCH HISTORY / SCORECARDS */}
                    <div className="w-full max-w-6xl mt-12 space-y-8">
                        {seriesComplete && (
                            <div className="bg-gradient-to-r from-emerald-900/20 to-slate-900 border border-emerald-500/30 p-8 rounded-2xl text-center shadow-2xl relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-emerald-500 to-transparent opacity-50"></div>
                                <h3 className="text-sm font-black text-emerald-500 uppercase tracking-[0.3em] mb-4">Series Summary</h3>
                                <div className="text-3xl md:text-5xl font-black text-white drop-shadow-lg">
                                    {typeof seriesComplete.summary === 'object' && seriesComplete.summary.scoreline 
                                        ? seriesComplete.summary.scoreline 
                                        : (typeof seriesComplete.summary === 'string' ? seriesComplete.summary : JSON.stringify(seriesComplete.summary))}
                                </div>
                            </div>
                        )}

                        {history.length > 0 && (
                            <div>
                                <h2 className="text-xl font-black text-slate-300 uppercase tracking-wider mb-6 flex items-center gap-3">
                                    <i data-lucide="history" className="w-6 h-6 text-slate-500"></i> Match History
                                </h2>
                                
                                <div className="grid gap-12">
                                    {history.map((m, idx) => (
                                        <div key={idx} className="bg-slate-950 rounded-2xl border border-slate-800 p-1 shadow-2xl">
                                            {/* Match Header */}
                                            <div className="bg-slate-900 p-4 rounded-t-xl flex justify-between items-center border-b border-slate-800">
                                                <span className="font-bold text-slate-400">Match {history.length - idx}</span>
                                                <div className="text-right">
                                                    <div className="text-emerald-400 font-bold">{m.winner} Won</div>
                                                    <div className="text-xs text-slate-500">by {m.margin}</div>
                                                </div>
                                            </div>
                                            
                                            {/* Scorecards Container */}
                                            <div className="p-4 md:p-6 grid lg:grid-cols-2 gap-8">
                                                {m.scorecard && Object.entries(m.scorecard).map(([name, data]) => (
                                                    <DetailedScorecard key={name} teamName={name} data={data} />
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        // Initialize icons after render
        setTimeout(() => lucide.createIcons(), 100);
    </script>
</body>
</html>